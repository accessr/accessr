<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accessr ‚Äî Free Accessibility Checker & Fixer for Word (.docx)</title>
  <meta name="description" content="Accessr is a free, privacy-first accessibility checker for Microsoft Word .docx. Runs entirely in your browser ‚Äî no uploads, no data collection." />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Crect width='256' height='256' rx='48' fill='%230B1020'/%3E%3Cpath fill='%233B82F6' d='M48 176h96a40 40 0 0 0 0-80H96l24-24H88l-40 40v16h16v48zM176 80h32v16h-32zM176 112h32v16h-32z'/%3E%3C/svg%3E" />
  <link rel="canonical" href="https://accessr.net/" />
  <meta property="og:title" content="Accessr ‚Äî Free Accessibility Checker & Fixer for Word (.docx)" />
  <meta property="og:description" content="Privacy-first .docx accessibility checker that runs fully in your browser." />
  <meta property="og:url" content="https://accessr.net/" />
  <meta property="og:type" content="website" />
  <link rel="stylesheet" href="/assets/style.css" />
  <style>/* Fallback if /assets/style.css is missing */html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif} .container{max-width:1100px;margin:0 auto;padding:24px} .btn{display:inline-block;padding:.75rem 1rem;border-radius:.75rem;background:#2563eb;color:#fff;text-decoration:none} .btn:hover{opacity:.95} .muted{color:#5b6472} header{position:sticky;top:0;background:#0b1020;color:#e6edf7;box-shadow:0 2px 12px rgba(0,0,0,.1)} header a{color:#cfe1ff;text-decoration:none} nav a{margin-right:1rem} .hero{padding:56px 0} .card{background:#0b10200a;border:1px solid #0b102013;border-radius:16px;padding:20px} footer{color:#7a8699;padding:40px 0} </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:16px;">
      <a href="/" style="display:flex;align-items:center;gap:.6rem;font-weight:700;font-size:1.05rem">
        <span style="width:28px;height:28px;display:inline-grid;place-items:center;background:#3b82f6;color:#fff;border-radius:8px">A</span>
        Accessr
      </a>
      <nav aria-label="Primary">
        <a href="/#tool">Tool</a>
        <a href="/blog/">Blog</a>
        <a href="/#privacy">Privacy</a>
      </nav>
    </div>
  </header>

  <main class="container hero">
    <h1 style="font-size:clamp(1.6rem,3vw,2.4rem);margin:0 0 .75rem 0;">Free, privacy‚Äëfirst accessibility checker for Word (.docx)</h1>
    <p class="muted" style="max-width:70ch">Accessr checks and fixes common accessibility issues in your .docx ‚Äî entirely in your browser. <strong>No uploads, no accounts, no data collection.</strong></p>
    <div style="margin-top:1rem">
      <a class="btn" href="#tool">Open the tool</a>
      <a class="btn" href="/blog/" style="background:#0b1020;border:1px solid #253046">Read the blog</a>
    </div>

    <!-- MERGED TOOL SECTION START -->
    <section class="wrap section grid grid-2" id="tool" aria-label="Accessibility tool" style="padding-left:0;padding-right:0">
      <style>
        #tool .pill{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;border:1px solid #273142;background:#0d141d}
        #tool .ok{color:#34d399} #tool .warn{color:#ffcc00} #tool .err{color:#ff6b6b}
        #tool .drop{border:2px dashed #24405d;border-radius:14px;padding:16px;text-align:center;background:#0e1624}
        #tool .drop.hover{background:#102338}
        #tool .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
        #tool .range{display:flex;gap:10px;align-items:center}
        #tool input[type="number"], #tool select{padding:8px 10px;border-radius:10px;border:1px solid #1b2430;background:#0c121a;color:inherit}
        #tool .mini{font-size:13px;opacity:.9}
        #tool details{background:#0c121a;border:1px solid #17202c;border-radius:12px;padding:12px}
        #tool pre{background:#0b1017;border:1px solid #17202c;border-radius:8px;padding:12px;overflow:auto}
      </style>

      <!-- LEFT CARD: upload + options + actions -->
      <div class="card" aria-labelledby="upload-h">
        <h2 id="upload-h">Check & Fix your .docx</h2>
        <p class="mini">Built for government, business, higher-ed, and community groups. No signup. No servers.</p>

        <div class="drop" id="drop" tabindex="0" role="region" aria-label="Drop zone ‚Äî drop a .docx file here">
          <p><strong>Drag & drop</strong> your file here, or</p>
          <button id="chooseBtn" type="button" class="btn">Choose a file</button>
          <input id="file" type="file" accept=".docx" />
          <p class="mini" id="filename" aria-live="polite"></p>

          <!-- SAMPLE BUTTONS (optional) -->
          <div class="mini" style="margin-top:12px">
            <p style="margin:0 0 6px">No file handy? Try a sample:</p>
            <a class="btn" href="samples/marketing-brief-before.docx" download>Example 1 ‚Äî Marketing Brief (Before)</a>
            <a class="btn" href="samples/marketing-brief-after.docx" download>Example 1 ‚Äî Marketing Brief (After)</a>
            <a class="btn" href="samples/policy-extract-before.docx" download>Example 2 ‚Äî Policy Extract (Before)</a>
            <a class="btn" href="samples/policy-extract-after.docx" download>Example 2 ‚Äî Policy Extract (After)</a>
            <p class="mini" style="margin-top:6px">‚ÄúBefore‚Äù docs include fake headings, raw URLs, tiny text, and tables without headers. ‚ÄúAfter‚Äù versions show the accessible structure.</p>
          </div>

          <div class="mini" style="display:grid;gap:8px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));margin-top:12px">
            <label style="display:flex;gap:8px;align-items:center"><input id="fixImgAlt" type="checkbox" checked /> Fix: Add placeholder image alt</label>
            <label style="display:flex;gap:8px;align-items:center"><input id="fixTblHdr" type="checkbox" checked /> Fix: Mark first table row as header</label>
            <label style="display:flex;gap:8px;align-items:center"><input id="fixLang"   type="checkbox" checked /> Fix: Add run language if missing</label>
            <label style="display:flex;gap:8px;align-items:center"><input id="fixHead"   type="checkbox" /> Fix: Convert obvious fake headings ‚Üí Heading 2</label>
            <label style="display:flex;gap:8px;align-items:center"><input id="fixSize"   type="checkbox" /> Fix: Raise tiny font to minimum</label>
            <label style="display:flex;gap:8px;align-items:center"><input id="fixList"   type="checkbox" /> Fix: Convert fake bullets to real list style</label>
          </div>

          <div class="mini" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:10px">
            <label style="display:flex;gap:8px;align-items:center">
              <input id="safeTouch" type="checkbox" checked />
              <span>Use SafeTouch (recommended)</span>
            </label>
            <label style="display:flex;gap:8px;align-items:center">
              <input id="compat" type="checkbox" checked />
              <span>Compat: preserve namespaces/root (fxp mode)</span>
            </label>
          </div>
          <div id="debug" class="mini" style="margin-top:8px;display:none"></div>
        </div>

        <div class="controls" role="group" aria-label="Options">
          <div class="range">
            <label for="lang" class="mini">Default language</label>
            <select id="lang" aria-label="Default language for runs">
              <option value="en-AU">English (Australia)</option>
              <option value="en-GB">English (UK)</option>
              <option value="en-US">English (US)</option>
            </select>
          </div>
          <div class="range">
            <label for="minFont" class="mini">Min font (pt)</label>
            <input id="minFont" type="number" min="10" max="16" step="1" value="11" />
          </div>
        </div>

        <div class="controls">
          <button id="runBtn" class="btn primary" disabled aria-disabled="true">Run checks</button>
          <a id="dlFixed" class="btn" style="display:none" download>Download fixed .docx</a>
          <a id="dlReport" class="btn" style="display:none" download>Download report.md</a>
        </div>
        <div id="status" class="live" aria-live="polite"></div>

        <div id="diag" class="mini" style="margin-top:10px; border:1px solid #1b2430; border-radius:10px; padding:10px; background:#0c121a; display:none">
          <div><strong>Diagnostics</strong></div>
          <div id="diagLib">‚Ä¢ Libraries: <em>checking‚Ä¶</em></div>
          <div id="diagFile">‚Ä¢ File: <em>none selected</em></div>
          <div id="diagReady">‚Ä¢ Ready: <em>no</em></div>
          <div id="diagErr" style="color:#ff6b6b; margin-top:6px;"></div>
        </div>
      </div>

      <!-- RIGHT CARD: results -->
      <div class="card" aria-labelledby="results-h">
        <h2 id="results-h">Results</h2>
        <div id="summary" class="mini" style="margin-bottom:8px"></div>
        <details>
          <summary>Show raw report (Markdown)</summary>
          <pre id="rawReport"></pre>
        </details>
        <div style="margin-top:12px">
          <span class="pill"><span class="ok">‚úÖ</span> Fixed</span>
          <span class="pill"><span class="warn">‚Ä¢</span> Needs review</span>
        </div>
      </div>
    </section>
    <!-- MERGED TOOL SECTION END -->

    <section id="privacy" style="margin-top:56px">
      <h2>Privacy & Security</h2>
      <ul>
        <li>All processing happens in your browser (client‚Äëside).</li>
        <li>No uploads, no cookies for tracking, no analytics by default.</li>
        <li>Add your preferred privacy‚Äëfriendly analytics later if desired (e.g., Plausible, Fathom).</li>
      </ul>
    </section>
  </main>

  <footer>
    <div class="container">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap">
        <small>¬© <span id="year"></span> Accessr</small>
        <nav aria-label="Footer">
          <a href="/blog/">Blog</a>
          <span aria-hidden="true">¬∑</span>
          <a href="#privacy">Privacy</a>
        </nav>
      </div>
    </div>
  </footer>

  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- Early safety wiring (keep as-is) -->
  <script>
  (function(){
    const chooseBtn = document.getElementById('chooseBtn');
    const fileInput = document.getElementById('file');
    const filenameEl = document.getElementById('filename');
    const runBtn = document.getElementById('runBtn');
    const diagWrap  = document.getElementById('diag');
    const diagFile  = document.getElementById('diagFile');
    const diagReady = document.getElementById('diagReady');
    const debugEl = document.getElementById('debug');

    function dbg(msg){ if(!debugEl) return; debugEl.style.display='block'; debugEl.textContent=String(msg); }
    function setDiagFile(text){ if(diagWrap) diagWrap.style.display='block'; if(diagFile) diagFile.innerHTML='‚Ä¢ File: ' + text; }
    function setDiagReady(ok){ if(diagWrap) diagWrap.style.display='block'; if(diagReady) diagReady.innerHTML='‚Ä¢ Ready: ' + (ok?'<span style="color:#34d399">yes</span>':'<span style="color:#ffcc00">no</span>'); }

    function onPick(f){
      window.__accessrSelectedFile = f || null;
      if (filenameEl) filenameEl.textContent = f ? ('Selected file: ' + (f.name||'')) : '';
      if (runBtn) { runBtn.disabled = !f; runBtn.setAttribute('aria-disabled', String(!f)); }
      if (f){
        dbg('Picked: ' + (f.name||'(no name)') + ' ‚Ä¢ type=' + (f.type||'(blank)') + ' ‚Ä¢ size=' + (f.size||0) + ' bytes');
        setDiagFile('<span style="color:#34d399">' + f.name + '</span> (' + (f.type||'') + ', ' + (f.size||0) + ' bytes)');
        setDiagReady(true);
      } else { setDiagFile('<em>none selected</em>'); setDiagReady(false); }
    }

    if (chooseBtn && fileInput){
      chooseBtn.addEventListener('click', function(){ try{ fileInput.click(); }catch(e){} });
      fileInput.addEventListener('change', function(){ onPick((fileInput.files && fileInput.files[0]) || null); });
    }
  })();
  </script>

  <!-- Vendor libraries (make sure these files exist in /vendor) -->
  <script src="./vendor/jszip.min.js"></script>
  <script src="./vendor/fxp.min.js"></script>
  <script src="./vendor/FileSaver.min.js"></script>

  <!-- FXP availability note -->
  <script>
  (function(){
    const hasFxpNS = !!(window.fxp && window.fxp.XMLParser && window.fxp.XMLBuilder);
    const hasGlobal = !!(window.XMLParser && window.XMLBuilder);
    const ok = !!window.JSZip && !!(hasFxpNS || hasGlobal) && !!window.saveAs;
    window.__XMLParserCtor  = hasFxpNS ? window.fxp.XMLParser  : (hasGlobal ? window.XMLParser  : null);
    window.__XMLBuilderCtor = hasFxpNS ? window.fxp.XMLBuilder : (hasGlobal ? window.XMLBuilder : null);
    const diag = document.getElementById('diag'), diagLib = document.getElementById('diagLib');
    if (diag) diag.style.display = 'block';
    if (diagLib) {
      diagLib.innerHTML = ok
        ? '‚Ä¢ Libraries: <span style="color:#34d399">OK (local)</span> ‚Äî (local)'
        : '‚Ä¢ Libraries: <span style="color:#ff6b6b">Missing /vendor files (jszip.min.js, fxp.min.js, FileSaver.min.js)</span>';
    }
  })();
  </script>

  <!-- App logic (from your original page) -->
  <script>
    // utils
    function ensureArray(x){ return Array.isArray(x) ? x : (x == null ? [] : [x]); }

    // report builder
    function makeReport(fileName){
      return {
        file: fileName || '(untitled)',
        issues: [],
        add(code, message, location, fixed, details){
          this.issues.push({ code:String(code||'INFO'), message:String(message||''), location:String(location||'Document'), fix_applied:!!fixed, details:details||{} });
        },
        toMarkdown(){
          if(!this.issues.length) return '# Accessibility Report for `'+this.file+'`\n\nüéâ No issues found.\n';
          const lines = ['# Accessibility Report for `'+this.file+'`',''];
          for (const it of this.issues){
            let line = `- **[${it.code}]** ${it.message} ‚Äî *${it.location}* (${it.fix_applied ? '‚úÖ fixed' : '‚ö† needs review'})`;
            if (it.details && Object.keys(it.details).length) line += `\n  - details: \`${JSON.stringify(it.details)}\``;
            lines.push(line);
          }
          return lines.join('\n');
        },
        counts(){ const t=this.issues.length,f=this.issues.filter(i=>i.fix_applied).length; return { total:t,fixed:f,flagged:t-f }; }
      };
    }

    // SafeTouch DOM-based minimal edits
    function xmlToDom(xml){
      const dom = new DOMParser().parseFromString(xml, 'application/xml');
      const err = dom.querySelector('parsererror');
      if (err) throw new Error('XML parse error');
      return dom;
    }
    function domToXml(dom){ return (new XMLSerializer()).serializeToString(dom); }

    function safeTouch_documentXml(xml, opts, report){
      const dom = xmlToDom(xml);
      const wns = 'http://schemas.openxmlformats.org/wordprocessingml/2006/main';
      const wps = 'http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing';

      // 1) Add placeholder image alt text
      if (opts.fixes.imgAlt){
        const docPrs = dom.getElementsByTagNameNS(wps, 'docPr');
        let added=0, total=docPrs.length;
        for (let i=0;i<docPrs.length;i++){
          const n = docPrs[i];
          const descr = n.getAttribute('descr');
          if (!descr || !descr.trim()){
            n.setAttribute('descr','IMAGE ‚Äì add descriptive alt text');
            added++;
          }
        }
        if (total>0){
          if (added>0) report.add('IMG-ALT->FIX',`Added placeholder alt text to ${added} of ${total} image(s).`,'Document',true);
          else report.add('IMG-ALT','All images already have alt text.','Document',false);
        }
      }

      // 2) Mark first table row as header if it looks like one
      if (opts.fixes.tblHeader){
        const tbls = dom.getElementsByTagNameNS(wns,'tbl');
        let fixed=0;
        for (let t=0;t<tbls.length;t++){
          const tbl = tbls[t];
          const rows = tbl.getElementsByTagNameNS(wns,'tr');
          if (!rows.length) continue;
          const first = rows[0];
          const cells = first.getElementsByTagNameNS(wns,'tc');
          if (!cells.length) continue;
          let hits=0;
          for (let c=0;c<cells.length;c++){
            const cell = cells[c];
            const texts = Array.from(cell.getElementsByTagNameNS(wns,'t')).map(n=>n.textContent||'').join(' ').trim();
            if (!texts) continue;
            if (texts.length<=25) hits++;
            if (/^[A-Z\s0-9]+$/.test(texts)) hits++;
            if (/^[A-Z][a-z]+(\s[A-Z][a-z]+)*$/.test(texts)) hits++;
          }
          if (hits >= Math.max(1, Math.floor(cells.length/2))){
            let trPr = first.getElementsByTagNameNS(wns,'trPr')[0];
            if (!trPr){ trPr = dom.createElementNS(wns,'w:trPr'); first.insertBefore(trPr, first.firstChild); }
            if (!trPr.getElementsByTagNameNS(wns,'tblHeader')[0]){
              const th = dom.createElementNS(wns,'w:tblHeader');
              th.setAttributeNS(wns,'w:val','true');
              trPr.appendChild(th);
              fixed++;
            }
          }
        }
        if (fixed>0) report.add('TBL-HEADER->FIX',`Marked first row as a repeating header in ${fixed} table(s).`,'Document',true);
      }

      // 3) Set run language where missing
      if (opts.fixes.lang){
        const runs = dom.getElementsByTagNameNS(wns,'r');
        let set=0;
        for (let i=0;i<runs.length;i++){
          const r = runs[i];
          let rPr = r.getElementsByTagNameNS(wns,'rPr')[0];
          if (!rPr){ rPr = dom.createElementNS(wns,'w:rPr'); r.insertBefore(rPr, r.firstChild); }
          let lang = rPr.getElementsByTagNameNS(wns,'lang')[0];
          let has = lang && (lang.getAttributeNS(wns,'val') || lang.getAttribute('w:val') || lang.getAttribute('val'));
          if (!has){
            if (!lang){ lang = dom.createElementNS(wns,'w:lang'); rPr.appendChild(lang); }
            lang.setAttributeNS(wns,'w:val', opts.lang);
            lang.setAttributeNS(wns,'w:eastAsia', opts.lang);
            lang.setAttributeNS(wns,'w:bidi', opts.lang);
            set++;
          }
        }
        if (set>0) report.add('DOC-LANG->FIX',`Set language to ${opts.lang} on ${set} run(s).`,'Document',true);
      }
      return domToXml(dom);
    }

    // FXP scaffolding (kept for compatibility switch)
    let parser = null, builder = null, __rawXmlByPart = Object.create(null);
    function graftRootTag(originalXml, rebuiltXml){
      function firstStartTag(xml){
        let i = xml.indexOf('<'); if (i < 0) return null;
        if (xml.slice(i, i+5).toLowerCase() === '<?xml'){
          const q = xml.indexOf('?>', i); if (q < 0) return null;
          i = xml.indexOf('<', q + 2); if (i < 0) return null;
        }
        const j = xml.indexOf('>', i); if (j < 0) return null;
        return { start: i, end: j + 1, text: xml.slice(i, j + 1) };
      }
      const orig = firstStartTag(originalXml); const newer = firstStartTag(rebuiltXml);
      if (!orig || !newer) return rebuiltXml;
      return rebuiltXml.slice(0, newer.start) + orig.text + rebuiltXml.slice(newer.end);
    }
    async function readXml(zip, name){ const xml = await zip.files[name].async('string'); __rawXmlByPart[name] = xml; return parser.parse(xml); }
    function writeXml(zip, name, obj, opts){
      let xmlStr = builder.build(obj);
      if (!xmlStr.startsWith('<?xml')) xmlStr = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' + xmlStr;
      if (opts && opts.compat && __rawXmlByPart[name]) xmlStr = graftRootTag(__rawXmlByPart[name], xmlStr);
      zip.file(name, xmlStr);
    }
    function listWordXmlParts(zip){
      const out=[]; for (const n of Object.keys(zip.files)){
        if(/^word\/document\.xml$/.test(n)) out.push(n);
        if(/^word\/header\d+\.xml$/.test(n)) out.push(n);
        if(/^word\/footer\d+\.xml$/.test(n)) out.push(n);
      } return out;
    }

    // Orchestrator
    async function processFile(file, opts){
      const buffer = await file.arrayBuffer();
      const zip = await JSZip.loadAsync(buffer);
      const parts = listWordXmlParts(zip);
      if(!parts.length) throw new Error('No Word XML parts found in document.');
      const report = makeReport(file.name);

      if (opts.safeTouch){
        for (const name of parts){
          const xml = await zip.files[name].async('string');
          const updated = safeTouch_documentXml(xml, opts, report);
          if (updated && updated !== xml){
            zip.file(name, updated);
          }
        }
      } else {
        const XMLParserCtor  = window.__XMLParserCtor;
        const XMLBuilderCtor = window.__XMLBuilderCtor;
        if (!XMLParserCtor || !XMLBuilderCtor) throw new Error('FXP libraries not available');
        const compatOn = !!opts.compat;
        parser = new XMLParserCtor({ ignoreAttributes:false, attributeNamePrefix:'', removeNSPrefix: !compatOn ? true : false });
        builder = new XMLBuilderCtor({ ignoreAttributes:false, attributeNamePrefix:'', format:true });
        for (const name of parts){
          const js = await readXml(zip, name);
          writeXml(zip, name, js, { compat: opts.compat });
        }
      }

      const content = await zip.generateAsync({ type:'blob' });
      const fixedBlob = new Blob([content], { type:'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
      const md = report.toMarkdown();
      const reportBlob = new Blob([md], { type: 'text/markdown;charset=utf-8' });
      return { report, fixedBlob, reportBlob };
    }

    // UI wiring
    (function(){
      const drop=document.getElementById('drop');
      const fileInput=document.getElementById('file');
      const chooseBtn=document.getElementById('chooseBtn');
      const runBtn=document.getElementById('runBtn');
      const dlFixed=document.getElementById('dlFixed');
      const dlReport=document.getElementById('dlReport');
      const rawReport=document.getElementById('rawReport');
      const statusEl=document.getElementById('status');
      const filename=document.getElementById('filename');
      const summary=document.getElementById('summary');
      const langSel=document.getElementById('lang');
      const minFont=document.getElementById('minFont');
      const compat=document.getElementById('compat');
      const safeTouch=document.getElementById('safeTouch');
      const fixImgAlt=document.getElementById('fixImgAlt');
      const fixTblHdr=document.getElementById('fixTblHdr');
      const fixLang=document.getElementById('fixLang');
      const fixHead=document.getElementById('fixHead');
      const fixSize=document.getElementById('fixSize');
      const fixList=document.getElementById('fixList');
      const diagWrap=document.getElementById('diag');
      const diagLib=document.getElementById('diagLib');
      const diagFile=document.getElementById('diagFile');
      const diagReady=document.getElementById('diagReady');
      const diagErr=document.getElementById('diagErr');

      let currentFile=null;

      function showDiag(){ if(diagWrap) diagWrap.style.display='block'; }
      function setDiagLib(ok,msg){ showDiag(); if(!diagLib) return; diagLib.innerHTML='‚Ä¢ Libraries: '+(ok?'<span style=\"color:#34d399\">OK (local)</span>':'<span style=\"color:#ff6b6b\">Missing</span>')+(msg?' ‚Äî '+msg:''); }
      function setDiagFile(text){ showDiag(); if(diagFile) diagFile.innerHTML='‚Ä¢ File: '+text; }
      function setDiagReady(ok){ showDiag(); if(diagReady) diagReady.innerHTML='‚Ä¢ Ready: '+(ok?'<span style=\"color:#34d399\">yes</span>':'<span style=\"color:#ffcc00\">no</span>'); }
      function setDiagErr(text){ showDiag(); if(diagErr) diagErr.textContent=text||''; }

      function looksLikeDocx(f){ if(!f) return false; const nameOk=/\.docx$/i.test(f.name||''); const mimeOk=(f.type||'').indexOf('officedocument.wordprocessingml.document')!==-1; return nameOk || mimeOk; }

      function setFile(f){
        currentFile=f;
        runBtn.disabled=!currentFile;
        runBtn.setAttribute('aria-disabled', String(!currentFile));
        filename.textContent=currentFile?('Selected file: '+currentFile.name):'';
        statusEl.textContent=currentFile?'Ready to process.':'';
        dlFixed.style.display='none'; dlReport.style.display='none';
        rawReport.textContent=''; summary.textContent='';
        setDiagFile(currentFile?('<span style=\"color:#34d399\">'+currentFile.name+'</span> ('+(currentFile.type||'')+', '+(currentFile.size||0)+' bytes)'):'<em>none selected</em>');
        setDiagReady(!!currentFile);
      }

      (function adoptEarlyPick(){
        const early = window.__accessrSelectedFile;
        const fi = document.getElementById('file');
        const f = early || (fi && fi.files && fi.files[0]) || null;
        if (f) setFile(f);
      })();

      setDiagLib(!!window.JSZip && !!(window.__XMLParserCtor && window.__XMLBuilderCtor), '(local)');

      if (chooseBtn && fileInput) chooseBtn.addEventListener('click', function(){ try{ fileInput.click(); }catch(e){} });
      fileInput.addEventListener('change', function(){
        const f=(fileInput.files && fileInput.files[0])||null;
        if(!f){ setFile(null); return; }
        if(!looksLikeDocx(f)){ setFile(null); statusEl.innerHTML="<span class='err'>Please choose a Microsoft Word (.docx) file.</span>"; return; }
        setFile(f);
      });
      ['dragenter','dragover'].forEach(evt=> drop.addEventListener(evt, e=>{ e.preventDefault(); e.stopPropagation(); drop.classList.add('hover'); }));
      ['dragleave','drop'].forEach(evt=> drop.addEventListener(evt, e=>{ e.preventDefault(); e.stopPropagation(); drop.classList.remove('hover'); }));
      drop.addEventListener('drop', e=>{
        const f=e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
        if(!f) return;
        if(!looksLikeDocx(f)){ statusEl.innerHTML="<span class='err'>Please drop a Word (.docx) file.</span>"; return; }
        setFile(f);
      });
      drop.addEventListener('click', function(e){
        const isBackground = e.target === drop;
        const isChooseBtn  = e.target && (e.target.id === 'chooseBtn');
        if (isBackground || isChooseBtn) fileInput.click();
      });
      Array.from(drop.querySelectorAll('input, label, select, button, a')).forEach(el=>{
        el.addEventListener('click', e => e.stopPropagation());
      });

      window.addEventListener('error', e=> setDiagErr('Script error: '+(e.message||'')));
      window.addEventListener('unhandledrejection', e=> setDiagErr('Unhandled promise: '+(e.reason && e.reason.message ? e.reason.message : String(e.reason || ''))));

      document.getElementById('runBtn').addEventListener('click', async function(){
        setDiagErr('');
        if(!currentFile){ statusEl.innerHTML="<span class='err'>No file selected.</span>"; return; }

        runBtn.disabled=true; runBtn.setAttribute('aria-disabled','true');
        statusEl.textContent='Processing‚Ä¶ (all on your device)';
        dlFixed.style.display='none'; dlReport.style.display='none';
        rawReport.textContent=''; summary.textContent='';

        try{
          const opts = {
            safeTouch: !!(safeTouch && safeTouch.checked),
            compat: !!(compat && compat.checked),
            lang: (document.getElementById('lang').value || 'en-AU'),
            minFontPt: Number(minFont.value || 11),
            fixes: {
              imgAlt: !!(fixImgAlt && fixImgAlt.checked),
              tblHeader: !!(fixTblHdr && fixTblHdr.checked),
              lang: !!(fixLang && fixLang.checked),
              headings: !!(fixHead && fixHead.checked), // fxp-only
              fontSize: !!(fixSize && fixSize.checked), // fxp-only
              list: !!(fixList && fixList.checked),     // fxp-only
            }
          };

          const { report, fixedBlob, reportBlob } = await processFile(currentFile, opts);
          const counts=report.counts();
          summary.innerHTML =
            '<span class="pill"><span class="warn">‚ö†</span> Total: '+counts.total+'</span> '+
            '<span class="pill"><span class="ok">‚úÖ</span> Fixed: '+counts.fixed+'</span> '+
            '<span class="pill"><span class="warn">‚Ä¢</span> Needs review: '+counts.flagged+'</span>';

          rawReport.textContent=report.toMarkdown();

          const ts=new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
          const base=currentFile.name.replace(/\.docx$/i,'')||'document';

          if(reportBlob){
            const url1=URL.createObjectURL(reportBlob);
            dlReport.href=url1; dlReport.download=base+'.a11y-report-'+ts+'.md'; dlReport.style.display='inline-flex';
          }
          if(fixedBlob){
            const url2=URL.createObjectURL(fixedBlob);
            dlFixed.href=url2; dlFixed.download=base+'.fixed-'+ts+'.docx'; dlFixed.style.display='inline-flex';
          }

          statusEl.textContent='Done. Download your fixed document and report below.';
        }catch(err){
          console.error(err);
          setDiagErr(err && err.message ? err.message : String(err));
          statusEl.innerHTML="<span class='err'>Error:</span> "+(err && err.message ? err.message : String(err));
        }finally{
          runBtn.disabled=!currentFile; runBtn.setAttribute('aria-disabled', String(!currentFile));
        }
      });
    })();
  </script>
</body>
</html>
